---
title: 正向代理与反向代理
date: 2021-11-28 00:41:57
permalink: /pages/210547/
categories:
  - 计算机
tags:
  - 
---

## 正向代理与反向代理

### 一、定义

#### 正向代理（ Forward Proxy ）：

> 是指是一个位于客户端和原始服务器之间的服务器，为了从原始服务器取得内容， 客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端才能使用正向代理。

![](https://raw.gitmirror.com/GanChuanYin/picture/main/blog/20220210105818.png)

#### 反向代理（ Reverse Proxy ）：

> 是指以代理服务器来接受 Internet 上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给 Internet 上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。

![](https://raw.gitmirror.com/GanChuanYin/picture/main/blog/20220210105901.png)





### 二、两种代理异同

#### 正向代理

1. 代理用户端，为用户提供服务;
2. 隐藏真实的客户，为客户端收发请求，**使真实客户端对服务器不可见**;
3. 一个局域网内的所有用户可能被一台服务器做了正向代理，由该台服务器负责 HTTP 请求;

#### 反向代理

1. 代理服务器，为服务器提供服务;
2. 隐藏了真实的服务器，为服务器收发请求，使真实服务器对客户端不可见;
3. 负载均衡服务器，将用户的请求分发到空闲的服务器上;

#### 共同点

1. 都是做为服务器和客户端的中间层

2. 都可以加强内网的安全性，阻止 web 攻击

3. 都可以做缓存机制，提高访问速度

   

#### 区别

1. **正向代理其实是客户端的代理,反向代理则是服务器的代理。**
2. **正向代理中，服务器并不知道真正的客户端到底是谁；而在反向代理中，客户端也不知道真正的服务器是谁。**
3. 作用不同。正向代理主要是用来解决访问限制问题；而反向代理则是提供负载均衡、安全防护等作用。




### 三、常用代理

#### 正向代理

##### 1.VPN

国内很多网站被墙，需要梯子翻墙才能访问，梯子的角色就是正向代理

##### 2. 前端跨域

前端开发时经常需要跨域访问接口，一般的跨域方案是采用正向代理，如vue-cli 采用 http-proxy-middleware插件来进行代理服务器等各项配置。

所以我们可以利用 proxyTable，设置地址映射表。即使用 `proxyTable` 这个属性进行相关的配置来解决跨域问题带来的烦恼。配置如下：

```
...
proxyTable: {
    '/weixin': {
        target: 'http://192.168.12.74:8080/', // 接口的域名
        secure: false,      // 如果是 https 接口，需要配置这个参数
        changeOrigin: true, // 如果接口跨域，需要进行这个参数配置
        pathRewrite: {
            '^/weixin': ''
        }
    },
},
...
```

##### 3. 隐藏客户端IP


#### 反向代理

##### 1.服务器负载均衡

```
# upstream 表示负载服务器池，定义名字为 my
upstream my {
    server 192.168.2.1:8080 weight=1 max_fails=2 fail_timeout=30s;
    server 192.168.2.2:8080 weight=1 max_fails=2 fail_timeout=30s;
    server 192.168.2.3:8080 weight=1 max_fails=2 fail_timeout=30s;
    server 192.168.2.4:8080 weight=1 max_fails=2 fail_timeout=30s;
   # 即在 30s 内尝试 2 次失败即认为主机不可用
  }
```

负载均衡即将 **请求/数据** 轮询分摊到多个服务器上执行，负载均衡的关键在于 **均匀**。

也可以通过 `ip-hash` 的方式，根据客户端 ip 地址的 hash 值将请求分配给固定的某一个服务器处理。

另外，服务器的硬件配置可能不同，配置好的服务器可以处理更多的请求，这时可以通过 `weight` 参数来控制。

##### 2.隐藏服务器真实IP
